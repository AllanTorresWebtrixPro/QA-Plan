#!/usr/bin/env node

/**
 * Basecamp Integration Setup Script
 *
 * This script helps you set up the Basecamp integration by prompting for
 * the necessary configuration values and creating a .env.local file.
 */

const fs = require("fs");
const path = require("path");
const readline = require("readline");

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout,
});

function question(prompt) {
  return new Promise((resolve) => {
    rl.question(prompt, resolve);
  });
}

async function setupBasecamp() {
  console.log("üöÄ Basecamp Integration Setup\n");
  console.log("This script will help you configure the Basecamp integration.");
  console.log(
    "You will need your Basecamp API credentials and project information.\n"
  );

  try {
    // Get configuration values
    const accountId = await question("Enter your Basecamp Account ID: ");
    const accessToken = await question("Enter your Basecamp Access Token: ");
    const userAgent =
      (await question(
        "Enter your User Agent (default: QA-Plan (atorres@jokertechnologies.com)): "
      )) || "QA-Plan (atorres@jokertechnologies.com)";

    console.log("\nüìã Next, we need to find your project and card table IDs.");
    console.log(
      "You can use the configuration page at /basecamp-config to discover these.\n"
    );

    const projectId = await question("Enter your Basecamp Project ID: ");
    const cardTableId = await question("Enter your Card Table ID: ");
    const defaultColumnId = await question("Enter your Default Column ID: ");

    // Create .env.local content
    const envContent = `# Basecamp API Configuration
# Generated by setup-basecamp.js
BASECAMP_ACCOUNT_ID=${accountId}
BASECAMP_ACCESS_TOKEN=${accessToken}
BASECAMP_USER_AGENT=${userAgent}
BASECAMP_PROJECT_ID=${projectId}
BASECAMP_CARD_TABLE_ID=${cardTableId}
BASECAMP_DEFAULT_COLUMN_ID=${defaultColumnId}

# Optional: Enable debug logging
# DEBUG_BASECAMP=true
`;

    // Write to .env.local
    const envPath = path.join(process.cwd(), ".env.local");
    fs.writeFileSync(envPath, envContent);

    console.log("\n‚úÖ Configuration saved to .env.local");
    console.log("\nüìù Next steps:");
    console.log("1. Restart your development server");
    console.log("2. Visit /basecamp-config to test the connection");
    console.log("3. Try adding a note to a test to verify card creation");
    console.log(
      "\n‚ö†Ô∏è  Important: Make sure .env.local is in your .gitignore file!"
    );
  } catch (error) {
    console.error("‚ùå Setup failed:", error.message);
  } finally {
    rl.close();
  }
}

// Run the setup
setupBasecamp();
